<html>

<head>
    <meta charset="utf-8">
    <title>花冠盛到酒业管理后台</title>
    <meta content="webkit" name="renderer" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="css/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/font-awesome/css/font-awesome.css">
    <style type="text/css">
input {
    margin-bottom: 0px;
    height: 30px;
}

.imgDiv {
    display: inline-block;
    position: relative;
    margin-right: 10px;
}

.imgDiv img {
    max-height: 150px;
    max-width: 150px;
}

.imgDiv .delete {
    background-color: rgba(255, 255, 255, 0.5);
    filter: op;
    position: absolute;
    top: 0px;
    right: 0px;
    font-size: 28px;
    padding-top: 5px;
}
    </style>
</head>

<body>
<div id="menu">
    <mymenu menu3="true"></mymenu>
</div>
<div class="content" id="divBody">
    <mynav name="图片压缩参数设置"></mynav>
    <div class="container-fluid">
    <div class="row-fluid">
        <div class="well">
        	<section class="editor selected" style="margin:0px 20px">
			    <section style="border: 0px; padding: 0px; box-sizing: border-box;" class="96wx-bdtc">
			        <section style="margin-left: 1em; line-height: 1.4; box-sizing: border-box;" class="96wx-bdtc">
			            <span style="display: inline-block; padding: 3px 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; color: rgb(255, 255, 255); font-size: 1em; background-color: rgb(0, 187, 236); font-family: inherit; font-weight: inherit; text-align: inherit; text-decoration: inherit; border-color: rgb(0, 187, 236); box-sizing: border-box;" class="96wx-bgc">
			            <section class="96wx-bdtc" style="box-sizing: border-box; font-size:18px;">
			               	 温馨提示：
			            </section>
			            </span> 
			        </section>
			        <section style="margin-top: -11px; padding: 22px 16px 16px; border: 1px solid rgb(192, 200, 209); color: rgb(51, 51, 51); font-size: 1em; font-family: inherit; font-weight: inherit; text-align: inherit; text-decoration: inherit; background-color: rgb(239, 239, 239); box-sizing: border-box;">
			            <p style="box-sizing: border-box;">
			                1、因原图较大，为提高页面加载速度，微信端显示的均是压缩处理后的图片，不显示原图。
			            </p>
			            <p style="box-sizing: border-box;">
			                2、<span style="color:red">压缩图</span>是微信端商品详情页显示的图片。
			            </p>
			            <p style="box-sizing: border-box;">
			                3、<span style="color:red">图标</span>是微信端商品列表页显示的图片，因列表页加载图片较多，低像素图标会显著提高页面打开速度。
			            </p>
			            <p style="box-sizing: border-box;">
			                4、<span style="color:red">压缩图压缩百分比</span>是指对原图质量的压缩。
			            </p>
			            <p style="box-sizing: border-box;">
			                5、<span style="color:red">压缩图最大像素值</span>，是指对原图大小按比例的压缩。例：设置为800，若原图1200X900，压缩后为800X600。
			            </p>
			            <p style="box-sizing: border-box;">
			                5、<span style="color:red">图标最大像素值</span>，是指对原图大小按比例的压缩。建议设置为100比较合适。
			            </p>
			        </section>
			    </section>
			</section>
			<p>
			    <br/>
			</p>
            <table class="table">
            	<tr cols="2" style="font-size:18px;">
            	</tr>
                <tr>
                    <td style="min-width:100px"><span id="compressedRateTd">压缩图压缩比率:</span></td>
                    <td>
                        <input type="number" v-model="compressedRate" placeholder="请输入压缩比率" />%</td>
                </tr>
                <tr>
                    <td><span id="compressedPixTd">压缩图最大像素值:</span></td>
                    <td>
                        <input type="number" v-model="compressedPix" placeholder="请输入压缩图最大像素值" /></td>
                </tr>
                <tr>
                    <td><span id="iconPixTd">图标最大像素值:</span></td>
                    <td>
                        <input type="number" v-model="iconPix" placeholder="请输入图标最大像素值" /></td>
                </tr>
                <tr>
                    <td style="text-align:center">
                    	<button type="button" class="btn btn-warning icon-plus" v-on:click="addPic">测试</button>
                        <input type="file" name="file" v-on:change="uploadFile" id="uploadFile" style="display:none" />
                    </td>
                    <td>
                        <button type="button" class="btn btn-primary" v-on:click="doIt"> <i class="icon-save"></i> 保存</button>
                        <button type="button" class="btn" onclick="window.history.go(-1)">取消</button>
                    </td>
                </tr>
                <tr v-show="showPic"><td>图标：</td>
                	<td><img :src="'upload/icon/'+imgUrl" /></td>
                </tr>
                <tr v-show="showPic"><td>压缩图：</td>
                	<td>
                	<a :href="'upload/compressed/'+imgUrl" target="_blank">
                		<img :src="'upload/compressed/'+imgUrl" />
                	</a></td>
                </tr>
                <tr v-show="showPic"><td>原图：</td>
                	<td>
                	<a :href="'upload/original/'+imgUrl" target="_blank">
                		<img :src="'upload/original/'+imgUrl" />
                	</a></td>
                </tr>
            </table>
        </div>
    </div>
    </div>
    <myfooter></myfooter>
</div>
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/layer.js"></script>
<script type="text/javascript" src="js/fileUpload.js"></script>
<script type="text/javascript" src="js/sync.js"></script>
<script type="text/javascript" src="js/header.js"></script>
<script type="text/javascript">
var db = new Vue({
    el: "#divBody",
    mounted: function() {
    	var tipLayer;
    	$( "#compressedRateTd" ).hover(
		  function() {
			tipLayer=layer.tips('对原图质量的压缩，压缩图在微信端详情页显示', '#compressedRateTd', {
				tips: 3
			});
		  }, function() {
		    layer.close(tipLayer);
		  }
		);
    	$( "#compressedPixTd" ).hover(
		  function() {
			tipLayer=layer.tips('宽、高取长的一边，设置为最大像素值，另一边按比例缩小', '#compressedPixTd', {
				tips: 3,
				time: 0
			});
		  }, function() {
		    layer.close(tipLayer);
		  }
		);
    	$( "#iconPixTd" ).hover(
		  function() {
			tipLayer=layer.tips('宽、高取长的一边，设置为最大像素值，另一边按比例缩小', '#iconPixTd', {
				tips: 3
			});
		  }, function() {
		    layer.close(tipLayer);
		  }
		);
    	
    	var that = this;
        post2SRV("queryImageConfig", function(data) {
            that.compressedRate = data.compressedRate;
            that.compressedPix = data.compressedPix;
            that.iconPix = data.iconPix;
        }, "json");
    },
    methods: {
		doIt:function(){
			if(!this.check()){
        		return;
        	}
			var param={
                compressedRate:db.compressedRate,
                compressedPix:db.compressedPix,
                iconPix:db.iconPix
            };
			post2SRV("saveImageConfig",param, function(data) {
				layer.msg("设置成功");
	        }, "json");
		}, 	
        addPic: function() {
        	if(!this.check()){
        		return;
        	}
            $("#uploadFile").click();
        },
        uploadFile: function(e){
            //formData上传文件
            var file = e.target.files[0];;
            if (file.type.indexOf('image') == -1) {
                alert('只能上传图片');
                return;
            }
            var param={
                compressedRate:db.compressedRate,
                compressedPix:db.compressedPix,
                iconPix:db.iconPix
            };
            $("#uploadFile").upload("imageTest", param,function(data) {
                db.imgUrl=data;
                db.showPic=true;
            });
        },
        check:function(){
        	if(this.compressedRate==""){
        		layer.msg("请输入压缩图压缩比率");
        		return false;
        	}
        	if(this.compressedPix==""){
        		layer.msg("请输入压缩图最大像素值");
        		return false;
        	}
        	if(this.iconPix==""){
        		layer.msg("请输入图标最大像素值");
        		return false;
        	}
        	return true;
        }
    },
    data: {
    	compressedRate:"",
    	compressedPix:"",
    	iconPix:"",
    	imgUrl: "",
    	showPic:false
    }
});
</script>
</body>

</html>